services:
  readsb:
    build: readsb/
    restart: unless-stopped
    container_name: readsb
    privileged: true
    ports:
      - 30003:30003
    env_file: config.vars
    environment:
      - RECEIVER_OPTIONS=--device-type rtlsdr --gain auto-verbose
      - DECODER_OPTIONS=--max-range 0 --write-json-every 1
      # Apparently, jaero-sbs takes priority over mlat, while normal sbs doesn't, so we use that
      - NET_OPTIONS=--net --net-heartbeat 60 --net-ro-size 1250 --net-ro-interval 0.05 --net-ri-port 30001 --net-ro-port 30002 --net-sbs-port 30003 --net-bi-port 30004,30104 --net-bo-port 30005 --net-sbs-jaero-in-port 30008 --jaero-timeout 1 --forward-mlat
      - JSON_OPTIONS=--json-location-accuracy 2 --range-outline-hours 24 --write-json /tmp/readsb --quiet
      #- FEEDING_OPTIONS=--net-connector feed1.adsbexchange.com,30004,beast_reduce_out,feed2.adsbexchange.com,64004,uuid=xxx --net-connector feed.airplanes.live,30004,beast_reduce_plus_out,feed.airplanes.live,64004,uuid=xxx --net-connector feed.adsb.lol,30004,beast_reduce_plus_out,in.adsb.lol,1337,uuid=xxx
    volumes:
      - /tmp:/tmp
  mlat-client-adsbx:
    build: mlat-client/
    container_name: mlat-client-adsbx
    restart: unless-stopped
    env_file: config.vars
    environment:
      - MLATSERVER=feed.adsbexchange.com:31090
      - BEAST_OUT_HOST=readsb:30005
      - BEAST_IN_HOST=readsb:30004
      #- UUID=xxx
  tar1090:
    build: tar1090
    container_name: tar1090
    restart: unless-stopped
    ports:
      - 80:80
    volumes:
      - /tmp/readsb:/tmp/readsb
      - /tmp/tar1090:/run/tar1090
  rtlsdr-ogn:
    build: rtlsdr-ogn
    container_name: rtlsdr-ogn
    restart: unless-stopped
    privileged: true
    ports:
      - 8080:8080
      - 8081:8081
      - 50001:50001
      - 50002:50002
    env_file: config.vars
    environment:
      - APRS_SERVER=ogn2dump1090:14580
  ogn2dump1090:
    build: ogn2dump1090
    container_name: ogn2dump1090
    restart: unless-stopped
    env_file: config.vars
    environment:
      - OGN_DECODE_TELNET_HOST=rtlsdr-ogn
      - OGN_DECODE_TELNET_PORT=50001
      - SBS_DESTINATION_HOST=readsb
      - SBS_DESTINATION_PORT=30008
