FROM debian:trixie
WORKDIR /app

RUN \
    apt update && \
    apt install --yes \
        nginx curl

ADD https://api.github.com/repos/wiedehopf/tar1090/git/refs/heads/master version.txt

ADD https://github.com/wiedehopf/tar1090/raw/master/install.sh install.sh

RUN chmod +x install.sh && ./install.sh /tmp/readsb

COPY Platzrunden_5.25.2.1.geojson /app/
RUN cp -f Platzrunden_5.25.2.1.geojson /usr/local/share/tar1090/html/geojson/UK_Mil_RC.geojson

COPY etc_nginx_sites-enabled_default /app/
RUN cp -f etc_nginx_sites-enabled_default /etc/nginx/sites-enabled/default

RUN cd /usr/local/share/tar1090/html && \
    echo 'jaeroTimeout = 60;' >> config.js && \
    echo 'jaeroLabel = "OGN";' >> config.js

ADD startup.sh startup.sh

CMD ["/bin/bash", "/app/startup.sh"]
